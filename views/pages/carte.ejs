<% title = "Carte ‚Äì La Hora" %>

<%
  // ‚úÖ Prix format√© "fr-FR"
  const formatPrice = (p) => {
    const n = Number(p);
    return Number.isFinite(n)
      ? new Intl.NumberFormat('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n) + ' ‚Ç¨'
      : p;
  };

  // ‚úÖ Libell√©s lisibles pour les cat√©gories
  const LABELS = {
    petitdejeuner: 'Petit-D√©jeuner',
    chaudes: 'Boissons Chaudes',
    sirops: 'Sirops',
    softs: 'Softs',
    bieres: 'Bi√®res',
    cocktails: 'Cocktails',
    alcool: 'Alcools',
    tapas: 'Tapas'
  };

  // Fallback si la cl√© n‚Äôest pas dans LABELS: "ma_categorie-test" -> "Ma categorie test"
  const labelize = (key) =>
    LABELS[key] ||
    key.replace(/[_-]+/g, ' ')
       .replace(/\w\S*/g, s => s.charAt(0).toUpperCase() + s.slice(1).toLowerCase());

  const isAll = (moment === 'all');
%>

<main class="pt-24 pb-16 px-4 sm:px-8 md:px-20">
  <div class="max-w-5xl mx-auto">
    <!-- Switch moment -->
    <nav class="flex items-center justify-center gap-2 mb-6">
      <a href="/carte?moment=matin"
         class="px-3 py-1 rounded-full text-sm <%= moment==='matin' ? 'bg-red-600 text-white' : 'bg-gray-800 text-gray-200 hover:bg-gray-700' %>">
        Matin
      </a>
      <a href="/carte?moment=all"
           class="inline-block bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded-full transition duration-200">
          üóÇÔ∏è Voir toute la carte
        </a>
      <a href="/carte?moment=soir"
         class="px-3 py-1 rounded-full text-sm <%= moment==='soir' ? 'bg-red-600 text-white' : 'bg-gray-800 text-gray-200 hover:bg-gray-700' %>">
        Soir
      </a>
    </nav>

    <!-- ===== Mode ALL : Matin & Soir sur la m√™me page ===== -->
    <% if (isAll) { %>
      <h1 class="text-4xl font-bold text-red-500 mb-10 text-center fade-in">Carte ‚Äî Matin & Soir</h1>

      <% const orderMoments = ['matin','soir']; %>
      <% orderMoments.forEach(function(m){ 
           const bloc = (typeof carteByMoment !== 'undefined' && carteByMoment) ? (carteByMoment[m] || {}) : {};
           const entries = Object.entries(bloc);
      %>
        <h2 class="text-3xl font-semibold mt-10 mb-6 <%= m==='matin' ? 'text-red-400' : 'text-red-300' %>">
          <%= m === 'matin' ? 'Matin ‚òï' : 'Soir üç∏' %>
        </h2>

        <% if (!entries.length) { %>
          <p class="text-sm text-gray-500 italic mb-8">Aucun produit pour ce moment.</p>
        <% } %>

        <% entries.forEach(function([category, items]){ %>
          <section class="mb-12 fade-in">
            <h3 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-1 text-red-400">
              <%= labelize(category) %>
            </h3>

            <% if (!items || !items.length) { %>
              <p class="text-sm text-gray-500 italic">Bient√¥t disponible.</p>
            <% } else { %>
              <ul class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <% items.forEach(function(item){ %>
                  <li class="flex items-start bg-gray-900 bg-opacity-80 p-4 rounded-lg shadow">
                    <% if (item.image) { %>
                      <img src="<%= item.image %>" alt="<%= item.name %>"
                           class="w-20 h-20 object-cover rounded mr-4"
                           onerror="this.src='/assets/img/placeholder.jpg'; this.onerror=null;">
                    <% } %>
                    <div>
                      <p class="text-lg font-medium text-white mb-1">
                        <%= item.name %>
                        <% if (item.price !== undefined && item.price !== null && item.price !== '') { %>
                          <span class="text-sm text-gray-400"> ‚Äì <%= formatPrice(item.price) %></span>
                        <% } %>
                      </p>
                      <% if (item.description) { %>
                        <p class="text-sm text-gray-400"><%= item.description %></p>
                      <% } %>
                    </div>
                  </li>
                <% }) %>
              </ul>
            <% } %>
          </section>
        <% }) %>
      <% }) %>

    <!-- ===== Mode simple : Matin OU Soir (comme avant) ===== -->
    <% } else { %>
      <h1 class="text-4xl font-bold text-red-500 mb-10 text-center fade-in">
        <%= moment === 'matin' ? 'Carte du Matin ‚òï' : 'Carte du Soir üç∏' %>
      </h1>

      <% const entries = Object.entries(carte || {}); %>
      <% if (!entries.length) { %>
        <p class="text-center text-gray-500">Aucun produit disponible.</p>
      <% } %>

      <% entries.forEach(([category, items]) => { %>
        <% if (items && items.length) { %>
          <section class="mb-12 fade-in">
            <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-1 text-red-400">
              <%= labelize(category) %>
            </h2>

            <ul class="grid grid-cols-1 sm:grid-cols-2 gap-6">
              <% items.forEach(item => { %>
                <li class="flex items-start bg-gray-900 bg-opacity-80 p-4 rounded-lg shadow">
                  <% if (item.image) { %>
                    <img src="<%= item.image %>" alt="<%= item.name %>"
                         class="w-20 h-20 object-cover rounded mr-4"
                         onerror="this.src='/assets/img/placeholder.jpg'; this.onerror=null;">
                  <% } %>
                  <div>
                    <p class="text-lg font-medium text-white mb-1">
                      <%= item.name %>
                      <% if (item.price !== undefined && item.price !== null && item.price !== '') { %>
                        <span class="text-sm text-gray-400"> ‚Äì <%= formatPrice(item.price) %></span>
                      <% } %>
                    </p>
                    <% if (item.description) { %>
                      <p class="text-sm text-gray-400"><%= item.description %></p>
                    <% } %>
                  </div>
                </li>
              <% }) %>
            </ul>
          </section>
        <% } %>
      <% }) %>

      <div class="text-center mt-12 space-y-4 fade-in">
        <a href="/carte?moment=<%= moment === 'matin' ? 'soir' : 'matin' %>"
           class="inline-block bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded-full transition duration-200">
          üîÅ Voir la carte du <%= moment === 'matin' ? 'soir' : 'matin' %>
        </a>
        <!-- <a href="/carte?moment=all"
           class="inline-block bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded-full transition duration-200">
          üóÇÔ∏è Voir toute la carte
        </a> -->
      </div>
    <% } %>
  </div>
</main>

